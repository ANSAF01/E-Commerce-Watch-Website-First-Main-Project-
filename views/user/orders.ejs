<%- include('../partials/head', { title: 'My Orders' }) %>
<%- include('../partials/header') %>

<main class="container-fluid py-5">
  <div class="row g-4">
    <div class="col-12 col-md-3 col-lg-3">
      <div class="position-sticky" style="top: 5rem;">
        <%- include('../partials/profile-sidebar', { page: 'orders', active: 'orders' }) %>
      </div>
    </div>
    <div class="col-12 col-md-9 col-lg-9">
      <div class="ps-md-3 mt-4">
        <h1 class="mb-3">My Orders</h1>
        <hr class="mb-4">
        <% if (!orders || orders.length === 0) { %>
          <div class="alert alert-info">No orders yet.</div>
        <% } else { %>
          <div class="table-responsive">
            <table class="table align-middle table-sm">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Total</th>
                  <th class="text-end">Action</th>
                </tr>
              </thead>
              <tbody>
                <% orders.forEach(o => { %>
                  <tr>
                    <td><strong><%= o.orderId %></strong></td>
                    <td><%= new Date(o.createdAt).toLocaleDateString() %></td>
                    <td>
                      <% let badgeClass = 'bg-info'; %>
                      <% if (o.status === 'DELIVERED') badgeClass = 'bg-success'; %>
                      <% if (o.status === 'CANCELLED') badgeClass = 'bg-danger'; %>
                      <% if (o.status === 'PENDING') badgeClass = 'bg-warning text-dark'; %>
                      <% if (o.status === 'CONFIRMED') badgeClass = 'bg-primary'; %>
                      <% if (o.status === 'SHIPPED') badgeClass = 'bg-info'; %>
                      <% if (o.status === 'OUT_FOR_DELIVERY') badgeClass = 'bg-info'; %>
                      <% if (o.status === 'RETURNED') badgeClass = 'bg-secondary'; %>
                      <span class="badge <%= badgeClass %>"><%= o.status %></span>
                    </td>
                    <td>â‚¹<%= Math.round(o.grandTotal) %></td>
                    <td class="text-end">
                      <a href="/user/orders/<%= o._id %>" class="btn btn-sm btn-outline-primary">View Details</a>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
          <%- include('../partials/pagination', { pagination }) %>
        <% } %>
      </div>
    </div>
  </div>
</main>

<%- include('../partials/footer') %>
