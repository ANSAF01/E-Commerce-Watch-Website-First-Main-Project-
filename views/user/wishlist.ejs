<%- include('../partials/head', { title: 'My Wishlist' }) %>
  <%- include('../partials/header') %>

    <main class="container-fluid py-5">
      <div class="row g-4">
        <div class="col-12 col-md-3 col-lg-3">
          <div class="position-sticky" style="top: 5rem;">
            <%- include('../partials/profile-sidebar', { page: 'wishlist' , active: 'wishlist' }) %>
          </div>
        </div>
        <div class="col-12 col-md-9 col-lg-9">
          <div class="ps-md-3 mt-4">
            <h1 class="mb-3">My Wishlist</h1>
            <hr class="mb-4">
            <% if (locals.user) { %>
              <% const items=(locals.wishlist && wishlist.items) ? wishlist.items : []; %>
                <% if (items.length===0) { %>
                  <div class="alert alert-info">Your wishlist is empty.</div>
                  <% } else { %>
                    <div class="row g-3">
                      <% items.forEach((it)=> { %>
                        <% const p=it.productId; %>
                          <div class="col-12 col-md-6">
                            <div class="card h-100">
                              <div class="card-body d-flex gap-3 align-items-center">
                                <img
                                  src="<%= (p && p.images && p.images[0]) ? (p.images[0].url || p.images[0]) : '/images/banner.jpg' %>"
                                  alt="<%= p ? p.name : 'Product' %>" class="rounded"
                                  style="width: 80px; height: 80px; object-fit: cover;">
                                <div class="flex-grow-1">
                                  <a href="/product/<%= p ? p._id : '' %>"
                                    class="fw-semibold text-decoration-none d-block">
                                    <%= p ? p.name : 'Unknown Product' %>
                                  </a>
                                  <div class="text-muted">
                                    <% if (p && p.bestOfferPercent && p.bestOfferPercent> 0) { %>
                                      <span class="text-success fw-semibold">₹<%= p.offerPrice %></span>
                                      <span class="text-decoration-line-through text-muted small ms-2">₹<%= p.price ?
                                          Math.round(p.price) : 0 %></span>
                                      <span class="badge bg-success ms-2">
                                        <%= p.bestOfferPercent %>% OFF
                                      </span>
                                      <% } else { %>
                                        ₹<%= p && p.price ? Math.round(p.price) : 0 %>
                                          <% } %>
                                  </div>
                                  <% if (p && p.stock <=0) { %>
                                    <div class="text-danger small mt-1">Out of Stock</div>
                                    <% } %>
                                      <div class="d-flex gap-2 mt-2">
                                        <button type="button" class="btn btn-sm btn-primary add-to-cart-btn"
                                          data-product-id="<%= p ? p._id : '' %>" <%=p && p.stock===0 ? 'disabled' : ''
                                          %>>
                                          <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                                        </button>
                                        <button type="button"
                                          class="btn btn-sm btn-outline-danger remove-from-wishlist-btn"
                                          data-product-id="<%= p ? p._id : '' %>">
                                          <i class="fas fa-trash me-1"></i>Remove
                                        </button>
                                      </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <% }) %>
                    </div>
                    <% } %>
                      <% } else { %>
                        <p>Please <a href="/auth/login">log in</a> to view your wishlist.</p>
                        <% } %>
          </div>
        </div>
      </div>
    </main>

    <%- include('../partials/footer') %>

      <script src="/js/user-common.js"></script>
      <script src="/js/pages/wishlist-page.js"></script>